<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校园二手交易平台 - 完整界面</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1890ff;
            --primary-dark: #096dd9;
            --primary-light: #e6f7ff;
            --success: #52c41a;
            --warning: #faad14;
            --error: #ff4d4f;
            --purple: #722ed1;
            --text-primary: #262626;
            --text-secondary: #8c8c8c;
            --text-tertiary: #bfbfbf;
            --border: #f0f0f0;
            --background: #fafafa;
            --card-bg: #ffffff;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app {
            max-width: 100%;
            min-height: 100vh;
            background: var(--background);
            position: relative;
            padding-bottom: 70px; /* 为底部导航栏留出空间 */
        }

        /* 页面容器 */
        .page-container {
            display: none;
            min-height: calc(100vh - 60px);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .page-container.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* 顶部导航栏 */
        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .logo i {
            font-size: 24px;
        }

        .nav-tabs {
            display: flex;
            gap: 30px;
        }

        .nav-tab {
            padding: 8px 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            transition: var(--transition);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-tab:hover {
            color: var(--primary);
        }

        .nav-tab.active {
            color: var(--primary);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            padding: 8px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary-light);
        }

        /* 购物车图标 */
        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-secondary);
            transition: var(--transition);
            padding: 8px;
        }

        .cart-icon:hover {
            color: var(--primary);
        }

        .cart-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--error);
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 主内容区域 */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 120px);
        }

        /* 搜索栏 */
        .search-bar {
            position: relative;
            margin-bottom: 24px;
        }

        .search-bar i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            z-index: 2;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px 14px 48px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 16px;
            background: var(--card-bg);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1);
        }

        /* 轮播图 */
        .banner {
            height: 200px;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 24px;
            position: relative;
        }

        .banner-slide {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 600;
        }

        /* 快捷入口 */
        .quick-access {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }

        .quick-item {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px 12px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .quick-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary-light);
        }

        .quick-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            color: var(--primary);
            font-size: 20px;
        }

        .quick-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* 商品网格 */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i {
            color: var(--primary);
        }

        .view-more {
            color: var(--primary);
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--border);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .product-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #f5f5f5;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-info {
            padding: 16px;
        }

        .product-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-box-orient: vertical;
        }

        .product-price {
            color: var(--error);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .product-original-price {
            color: var(--text-tertiary);
            text-decoration: line-through;
            font-size: 14px;
            margin-left: 8px;
        }

        .product-tags {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .tag-new {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success);
        }

        .tag-hot {
            background: rgba(255, 77, 79, 0.1);
            color: var(--error);
        }

        .tag-discount {
            background: rgba(250, 173, 20, 0.1);
            color: var(--warning);
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 12px;
            padding-top: 8px;
            border-top: 1px solid var(--border);
        }

        .product-location {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* 市场页面 */
        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .market-tabs {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .market-tab {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--background);
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
        }

        .market-tab.active {
            background: var(--primary);
            color: white;
        }

        .market-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn.active {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--primary-light);
        }

        /* 发布页面 */
        .publish-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .publish-form {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            background: var(--card-bg);
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1);
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: var(--text-tertiary);
        }

        .upload-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* 图片预览区域 */
        .uploaded-images {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 16px;
        }

        .image-preview {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .remove-image:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        /* 消息页面 */
        .messages-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .message-item {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .message-item:hover {
            background: var(--background);
        }

        .message-item.unread {
            background: var(--primary-light);
        }

        .message-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 20px;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .message-sender {
            font-weight: 600;
            color: var(--text-primary);
        }

        .message-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .message-preview {
            font-size: 14px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .unread-badge {
            background: var(--error);
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        /* 我的页面样式 */
        .profile-header {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow);
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--primary-light);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-id {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .profile-stats {
            display: flex;
            gap: 30px;
            margin-top: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            display: block;
        }

        /* 我的功能菜单 */
        .my-menu {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .menu-section {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .menu-section:last-child {
            border-bottom: none;
        }

        .section-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: block;
        }

        .menu-items {
            display: grid;
            gap: 12px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .menu-item:hover {
            background: var(--primary-light);
        }

        .menu-item-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .menu-text {
            font-weight: 500;
            color: var(--text-primary);
        }

        .menu-badge {
            background: var(--error);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        .menu-arrow {
            color: var(--text-tertiary);
        }

        /* 订单列表 */
        .orders-list {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .order-item {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: var(--transition);
            cursor: pointer;
        }

        .order-item:hover {
            background: var(--background);
        }

        .order-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
        }

        .order-info {
            flex: 1;
        }

        .order-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .order-price {
            color: var(--error);
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .order-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .status-waiting {
            background: rgba(250, 173, 20, 0.1);
            color: var(--warning);
        }

        .status-success {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success);
        }

        .status-failed {
            background: rgba(255, 77, 79, 0.1);
            color: var(--error);
        }

        /* 底部导航栏 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .bottom-nav-items {
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .quick-access {
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }

            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .nav-tabs {
                display: none;
            }

            .user-actions {
                display: none;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            .profile-stats {
                justify-content: center;
                gap: 20px;
            }

            .menu-item {
                padding: 10px 12px;
            }

            .publish-form {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .quick-access {
                grid-template-columns: repeat(3, 1fr);
            }

            .products-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--background);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 20px;
        }

        /* 发布成功消息框 */
        .publish-success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .publish-success-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            width: 100%;
            max-width: 400px;
            padding: 30px;
            text-align: center;
            animation: slideUp 0.3s ease;
        }

        .success-icon {
            font-size: 48px;
            color: var(--success);
            margin-bottom: 20px;
        }

        .success-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .success-message {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        /* 骨架屏 */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200px 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes skeleton-loading {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: 8px;
        }

        .skeleton-image {
            height: 180px;
            margin-bottom: 16px;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--border);
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-subtext {
            font-size: 14px;
            color: var(--text-tertiary);
        }

        /* 加载动画 */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 页面切换动画 */
        @keyframes pageSlideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pageSlideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(-20px);
            }
        }

        .page-slide-in {
            animation: pageSlideIn 0.3s ease forwards;
        }

        .page-slide-out {
            animation: pageSlideOut 0.3s ease forwards;
        }

        /* 返回顶部按钮 */
        .back-to-top {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            opacity: 0;
            transform: translateY(20px);
            z-index: 999;
            box-shadow: var(--shadow);
        }

        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .back-to-top:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* 聊天页面样式 */
        #chatPage {
            background: var(--background);
        }

        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            height: calc(100vh - 140px);
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .back-button {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .back-button:hover {
            background: var(--background);
            color: var(--text-primary);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 18px;
        }

        .chat-user-info {
            flex: 1;
        }

        .chat-user-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .chat-user-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .chat-actions {
            display: flex;
            gap: 8px;
        }

        .chat-action-btn {
            background: none;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-action-btn:hover {
            background: var(--background);
            color: var(--text-primary);
        }

        .messages-list {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-bubble.received {
            background: var(--primary-light);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message-bubble.sent {
            background: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .message-time {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
            text-align: right;
        }

        .message-bubble.sent .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .chat-input-area {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            background: var(--card-bg);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 24px;
            background: var(--background);
            font-size: 14px;
            transition: var(--transition);
            resize: none;
            max-height: 100px;
            min-height: 44px;
            line-height: 1.4;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--card-bg);
        }

        .send-button {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .send-button:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .send-button:disabled {
            background: var(--text-tertiary);
            cursor: not-allowed;
            transform: none;
        }

        .no-chat-selected {
            display: flex;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 140px);
            color: var(--text-secondary);
            text-align: center;
        }

        .no-chat-icon {
            font-size: 64px;
            margin-bottom: 16px;
            color: var(--border);
        }

        /* 消息类型指示器 */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: var(--primary-light);
            border-radius: 18px;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typingAnimation {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* 商品详情页面样式 */
        .product-detail-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        /* 返回按钮 */
        .product-detail-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--card-bg);
            position: sticky;
            top: 60px;
            z-index: 10;
        }

        .product-back-button {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .product-back-button:hover {
            background: var(--background);
            color: var(--text-primary);
        }

        .product-detail-content {
            padding: 0;
        }

        /* 第一部分：商品图片 */
        .product-images-section {
            position: relative;
        }

        .main-product-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            background: #f5f5f5;
        }

        /* 第二部分：商品信息 */
        .product-info-section {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .product-price-section {
            margin-bottom: 16px;
        }

        .product-current-price {
            color: var(--error);
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .product-original-price-detail {
            color: var(--text-tertiary);
            text-decoration: line-through;
            font-size: 16px;
            font-weight: 400;
        }

        .product-discount-badge {
            background: var(--error);
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        .product-title-detail {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .product-tags-detail {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .product-tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .product-tag.urgent {
            background: rgba(255, 77, 79, 0.1);
            color: var(--error);
        }

        .product-tag.new {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success);
        }

        .product-tag.hot {
            background: rgba(250, 173, 20, 0.1);
            color: var(--warning);
        }

        .product-tag.discount {
            background: rgba(24, 144, 255, 0.1);
            color: var(--primary);
        }

        /* 商家描述 */
        .seller-description {
            background: var(--primary-light);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .seller-description-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .seller-description-header i {
            color: var(--primary);
        }

        .seller-description-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .seller-description-content {
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* 商品规格 */
        .product-specs {
            margin-top: 16px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .spec-item:last-child {
            border-bottom: none;
        }

        .spec-label {
            color: var(--text-secondary);
        }

        .spec-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* 商品详情描述 */
        .product-description-section {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .section-title-detail {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title-detail i {
            color: var(--primary);
        }

        .product-full-description {
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-line;
        }

        /* 卖家信息 */
        .seller-info-section {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .seller-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary-light);
        }

        .seller-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .seller-info {
            flex: 1;
        }

        .seller-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .seller-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .seller-rating {
            color: var(--warning);
        }

        /* 第三部分：操作按钮 */
        .product-actions-section {
            padding: 20px;
            background: var(--card-bg);
            position: sticky;
            bottom: 70px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 14px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-cart {
            background: var(--warning);
            color: white;
        }

        .action-cart:hover {
            background: #e69700;
            transform: translateY(-2px);
        }

        .action-buy {
            background: var(--error);
            color: white;
        }

        .action-buy:hover {
            background: #d9363e;
            transform: translateY(-2px);
        }

        .action-favorite {
            background: var(--purple);
            color: white;
        }

        .action-favorite:hover {
            background: #5c1ebd;
            transform: translateY(-2px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .product-actions-section {
                bottom: 60px;
                padding: 16px;
            }
            
            .action-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .main-product-image {
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .product-actions-section {
                flex-direction: column;
                bottom: 60px;
            }
            
            .action-btn {
                width: 100%;
            }
            
            .main-product-image {
                height: 200px;
            }
        }

        /* 购物车页面 */
        .cart-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .cart-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-items {
            padding: 20px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .cart-item:hover {
            background: var(--background);
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 16px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-title {
            font-weight: 500;
            margin-bottom: 8px;
        }

        .cart-item-price {
            color: var(--error);
            font-weight: 600;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--background);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .quantity-input {
            width: 40px;
            text-align: center;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 4px;
        }

        .cart-item-remove {
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 8px;
        }

        .cart-item-remove:hover {
            color: var(--error);
        }

        .cart-total {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--background);
        }

        .cart-total-label {
            font-size: 16px;
            font-weight: 500;
        }

        .cart-total-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--error);
        }

        /* 收藏页面 */
        .favorites-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .favorites-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .favorite-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* 我的卖出/买到页面 */
        .my-items-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .my-items-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .my-items-tabs {
            display: flex;
            gap: 10px;
        }

        .my-items-tab {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--background);
            color: var(--text-secondary);
            cursor: pointer;
        }

        .my-items-tab.active {
            background: var(--primary);
            color: white;
        }

        .my-items-list {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="app" id="app">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="header-content">
                <div class="logo" onclick="switchPage('home')">
                    <i class="fas fa-recycle"></i>
                    校园二手
                </div>
                <div class="nav-tabs">
                    <div class="nav-tab active" data-page="home" onclick="switchPage('home')">
                        <i class="fas fa-home"></i> 首页
                    </div>
                    <div class="nav-tab" data-page="market" onclick="switchPage('market')">
                        <i class="fas fa-store"></i> 市场
                    </div>
                    <div class="nav-tab" data-page="publish" onclick="switchPage('publish')">
                        <i class="fas fa-plus-circle"></i> 发布
                    </div>
                    <div class="nav-tab" data-page="messages" onclick="switchPage('messages')">
                        <i class="fas fa-comments"></i> 消息
                    </div>
                    <div class="nav-tab" data-page="my" onclick="switchPage('my')">
                        <i class="fas fa-user"></i> 我的
                    </div>
                </div>
                <div class="user-actions">
                    <div class="cart-icon" onclick="switchPage('cart')">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge" id="cartBadge">0</span>
                    </div>
                    <button class="btn btn-outline" onclick="showLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> 登录
                    </button>
                    <button class="btn btn-primary" onclick="showRegisterModal()">
                        <i class="fas fa-user-plus"></i> 注册
                    </button>
                </div>
            </div>
        </header>

        <!-- 首页 -->
        <div id="homePage" class="page-container active">
            <main class="main-content">
                <!-- 搜索栏 -->
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" 
                           class="search-input" 
                           placeholder="搜索商品、用户、学院..."
                           id="searchInput"
                           onkeypress="handleSearch(event)">
                </div>

                <!-- 轮播图 -->
                <div class="banner">
                    <div class="banner-slide">
                        校园二手交易平台 - 让闲置物品焕发新生
                    </div>
                </div>

                <!-- 快捷入口 -->
                <div class="quick-access">
                    <div class="quick-item" onclick="switchPage('market')">
                        <div class="quick-icon">
                            <i class="fas fa-th-large"></i>
                        </div>
                        <div class="quick-name">全部分类</div>
                    </div>
                    <div class="quick-item" onclick="switchPage('market', 'new')">
                        <div class="quick-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="quick-name">新品发布</div>
                    </div>
                    <div class="quick-item" onclick="switchPage('market', 'urgent')">
                        <div class="quick-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="quick-name">急出专区</div>
                    </div>
                    <div class="quick-item" onclick="switchPage('publish')">
                        <div class="quick-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <div class="quick-name">发布商品</div>
                    </div>
                    <div class="quick-item" onclick="switchPage('market', 'nearby')">
                        <div class="quick-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="quick-name">附近二手</div>
                    </div>
                </div>

                <!-- 推荐商品 -->
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-star"></i> 推荐商品
                    </h3>
                    <div class="view-more" onclick="switchPage('market')">
                        查看更多 <i class="fas fa-chevron-right"></i>
                    </div>
                </div>

                <div class="products-grid" id="recommendedProducts">
                    <!-- 商品卡片会通过JS动态生成 -->
                </div>

                <!-- 热卖商品 -->
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-fire"></i> 热卖商品
                    </h3>
                    <div class="view-more" onclick="switchPage('market')">
                        查看更多 <i class="fas fa-chevron-right"></i>
                    </div>
                </div>

                <div class="products-grid" id="hotProducts">
                    <!-- 商品卡片会通过JS动态生成 -->
                </div>
            </main>
        </div>

        <!-- 市场页面 -->
        <div id="marketPage" class="page-container">
            <main class="main-content">
                <div class="market-header">
                    <h3 class="section-title">
                        <i class="fas fa-store"></i> 二手市场
                    </h3>
                    <div class="market-tabs" id="marketTabs">
                        <div class="market-tab active" onclick="filterByCategory('all')">全部</div>
                        <div class="market-tab" onclick="filterByCategory('digital')">数码产品</div>
                        <div class="market-tab" onclick="filterByCategory('books')">教材书籍</div>
                        <div class="market-tab" onclick="filterByCategory('clothing')">服装鞋帽</div>
                        <div class="market-tab" onclick="filterByCategory('daily')">生活用品</div>
                        <div class="market-tab" onclick="filterByCategory('sports')">运动户外</div>
                    </div>
                </div>

                <div class="market-filters" id="marketFilters">
                    <div class="filter-btn active" onclick="filterBySort('default')">默认排序</div>
                    <div class="filter-btn" onclick="filterBySort('price-low')">价格从低到高</div>
                    <div class="filter-btn" onclick="filterBySort('price-high')">价格从高到低</div>
                    <div class="filter-btn" onclick="filterBySort('newest')">最新发布</div>
                </div>

                <div class="products-grid" id="marketProducts">
                    <!-- 市场商品会通过JS动态生成 -->
                </div>

                <div class="load-more" id="loadMoreContainer">
                    <button class="btn btn-outline" style="width: 100%;" onclick="loadMoreMarketProducts()" id="loadMoreBtn">
                        <i class="fas fa-spinner"></i> 加载更多商品
                    </button>
                </div>
            </main>
        </div>

        <!-- 发布页面 -->
        <div id="publishPage" class="page-container">
            <main class="main-content">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-plus-circle"></i> 发布商品
                    </h3>
                </div>

                <div class="publish-container">
                    <div class="publish-form" id="publishForm">
                        <div class="form-group">
                            <label class="form-label">商品标题</label>
                            <input type="text" class="form-control" placeholder="请输入商品标题，如：二手MacBook Pro 2020款" id="productTitle">
                        </div>

                        <div class="form-group">
                            <label class="form-label">商品分类</label>
                            <select class="form-control" id="productCategory">
                                <option value="">请选择分类</option>
                                <option value="digital">数码产品</option>
                                <option value="books">教材书籍</option>
                                <option value="clothing">服装鞋帽</option>
                                <option value="daily">生活用品</option>
                                <option value="sports">运动户外</option>
                                <option value="beauty">美妆个护</option>
                                <option value="other">其他</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">商品价格（元）</label>
                            <input type="number" class="form-control" placeholder="请输入商品价格" id="productPrice">
                        </div>

                        <div class="form-group">
                            <label class="form-label">原价（元）</label>
                            <input type="number" class="form-control" placeholder="请输入商品原价（选填）" id="originalPrice">
                        </div>

                        <div class="form-group">
                            <label class="form-label">商品描述</label>
                            <textarea class="form-control" rows="4" placeholder="请详细描述商品信息，如新旧程度、使用情况、包含配件等" id="productDescription"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">商品图片</label>
                            <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                                <input type="file" 
                                       id="imageInput" 
                                       class="upload-input" 
                                       accept="image/*" 
                                       multiple 
                                       onchange="handleImageUpload(event)">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="upload-text">点击或拖拽图片到这里上传</div>
                                <div class="upload-hint">支持 JPG/PNG 格式，大小不超过 5MB</div>
                            </div>
                            <div class="uploaded-images" id="uploadedImages"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">联系方式</label>
                            <input type="tel" class="form-control" placeholder="请输入手机号码" value="13800138000" id="contactPhone">
                        </div>

                        <button class="btn btn-primary" style="width: 100%; padding: 16px; font-size: 16px;" onclick="submitProduct()" id="submitProductBtn">
                            <i class="fas fa-paper-plane"></i> 立即发布
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- 消息页面 -->
        <div id="messagesPage" class="page-container">
            <main class="main-content">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-comments"></i> 消息中心
                    </h3>
                    <div class="view-more" onclick="markAllAsRead()">
                        全部标记已读
                    </div>
                </div>

                <div class="messages-container" id="messagesList">
                    <!-- 消息列表会通过JS动态生成 -->
                </div>

                <div class="empty-state" id="noMessages" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-comment-slash"></i>
                    </div>
                    <div class="empty-text">暂无消息</div>
                    <div class="empty-subtext">快去浏览商品，开始聊天吧</div>
                </div>
            </main>
        </div>

        <!-- 聊天页面 -->
        <div id="chatPage" class="page-container">
            <main class="main-content">
                <div class="chat-container" id="chatContainer">
                    <!-- 聊天界面会通过JS动态生成 -->
                </div>
            </main>
        </div>

        <!-- 商品详情页面 -->
        <div id="productDetailPage" class="page-container">
            <main class="main-content">
                <div class="product-detail-container" id="productDetailContainer">
                    <!-- 内容会通过JS动态生成 -->
                </div>
            </main>
        </div>

        <!-- 购物车页面 -->
        <div id="cartPage" class="page-container">
            <main class="main-content">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-shopping-cart"></i> 购物车
                    </h3>
                    <div class="view-more" onclick="clearCart()">
                        清空购物车
                    </div>
                </div>

                <div class="cart-container" id="cartContainer">
                    <div class="cart-items" id="cartItems">
                        <!-- 购物车商品会通过JS动态生成 -->
                    </div>
                    <div class="cart-total">
                        <div class="cart-total-label">总计</div>
                        <div class="cart-total-price" id="cartTotalPrice">¥0</div>
                    </div>
                </div>

                <div class="empty-state" id="emptyCart" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="empty-text">购物车空空如也</div>
                    <div class="empty-subtext">快去逛逛市场吧</div>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="switchPage('market')">
                        <i class="fas fa-store"></i> 去市场逛逛
                    </button>
                </div>

                <button class="btn btn-primary" style="width: 100%; padding: 16px; font-size: 16px; margin-top: 20px;" onclick="checkoutCart()" id="checkoutBtn">
                    <i class="fas fa-check-circle"></i> 去结算
                </button>
            </main>
        </div>

        <!-- 我的页面 -->
        <div id="myPage" class="page-container">
            <main class="main-content">
                <!-- 个人信息头部 -->
                <div class="profile-header">
                    <div class="avatar">
                        <img src="src/用户头像.jpg" alt="用户头像" onerror="this.src='https://randomuser.me/api/portraits/men/32.jpg'">
                    </div>
                    <div class="profile-info">
                        <div class="profile-name" id="userName">张三</div>
                        <div class="profile-id">学号：20230001</div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-value" id="sellingCount">12</span>
                                <span class="stat-label">在售商品</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="soldCount">56</span>
                                <span class="stat-label">已售商品</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="rating">98.5%</span>
                                <span class="stat-label">好评率</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="editProfile()">
                        <i class="fas fa-edit"></i> 编辑资料
                    </button>
                </div>

                <!-- 我的功能菜单 -->
                <div class="my-menu">
                    <div class="menu-section">
                        <span class="section-label">交易管理</span>
                        <div class="menu-items">
                            <div class="menu-item" onclick="switchPage('mySelling')">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-box-open"></i>
                                    </div>
                                    <span class="menu-text">我卖出的</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                            <div class="menu-item" onclick="switchPage('myBuying')">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <span class="menu-text">我买到的</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                            <div class="menu-item" onclick="switchPage('myFavorites')">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-heart"></i>
                                    </div>
                                    <span class="menu-text">我的收藏</span>
                                </div>
                                <span class="menu-badge" id="favoriteCount">12</span>
                            </div>
                        </div>
                    </div>

                    <div class="menu-section">
                        <span class="section-label">账号管理</span>
                        <div class="menu-items">
                            <div class="menu-item" onclick="viewSettings()">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-cog"></i>
                                    </div>
                                    <span class="menu-text">设置</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                            <div class="menu-item" onclick="viewSecurity()">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <span class="menu-text">安全中心</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                            <div class="menu-item" onclick="viewFeedback()">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-comment-dots"></i>
                                    </div>
                                    <span class="menu-text">意见反馈</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                        </div>
                    </div>

                    <div class="menu-section">
                        <span class="section-label">其他</span>
                        <div class="menu-items">
                            <div class="menu-item" onclick="viewHelp()">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-question-circle"></i>
                                    </div>
                                    <span class="menu-text">帮助中心</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                            <div class="menu-item" onclick="viewAbout()">
                                <div class="menu-item-left">
                                    <div class="menu-icon">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <span class="menu-text">关于我们</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                            <div class="menu-item" onclick="logout()" style="color: var(--error);">
                                <div class="menu-item-left">
                                    <div class="menu-icon" style="background: rgba(255, 77, 79, 0.1); color: var(--error);">
                                        <i class="fas fa-sign-out-alt"></i>
                                    </div>
                                    <span class="menu-text">退出登录</span>
                                </div>
                                <i class="fas fa-chevron-right menu-arrow"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 我的订单 -->
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-clipboard-list"></i> 最近订单
                    </h3>
                    <a href="#" class="view-more" onclick="viewAllOrders()">
                        查看全部 <i class="fas fa-chevron-right"></i>
                    </a>
                </div>

                <div class="orders-list" id="myOrders">
                    <!-- 订单会通过JS动态生成 -->
                </div>

                <div class="empty-state" id="noOrders" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="empty-text">暂无订单</div>
                    <div class="empty-subtext">快去逛逛市场吧</div>
                </div>
            </main>
        </div>

        <!-- 我卖出的页面 -->
        <div id="mySellingPage" class="page-container">
            <main class="main-content">
                <div class="my-items-container">
                    <div class="my-items-header">
                        <h3 class="section-title">
                            <i class="fas fa-box-open"></i> 我卖出的商品
                        </h3>
                        <button class="btn btn-outline" onclick="switchPage('publish')">
                            <i class="fas fa-plus"></i> 发布新商品
                        </button>
                    </div>
                    <div class="products-grid" id="mySellingProducts">
                        <!-- 我卖出的商品会通过JS动态生成 -->
                    </div>
                </div>
            </main>
        </div>

        <!-- 我买到的页面 -->
        <div id="myBuyingPage" class="page-container">
            <main class="main-content">
                <div class="my-items-container">
                    <div class="my-items-header">
                        <h3 class="section-title">
                            <i class="fas fa-shopping-cart"></i> 我买到的商品
                        </h3>
                    </div>
                    <div class="products-grid" id="myBuyingProducts">
                        <!-- 我买到的商品会通过JS动态生成 -->
                    </div>
                </div>
            </main>
        </div>

        <!-- 我的收藏页面 -->
        <div id="myFavoritesPage" class="page-container">
            <main class="main-content">
                <div class="my-items-container">
                    <div class="my-items-header">
                        <h3 class="section-title">
                            <i class="fas fa-heart"></i> 我的收藏
                        </h3>
                        <div class="favorite-actions">
                            <button class="btn btn-outline" onclick="clearAllFavorites()">
                                <i class="fas fa-trash"></i> 清空收藏
                            </button>
                        </div>
                    </div>
                    <div class="products-grid" id="myFavoritesProducts">
                        <!-- 收藏的商品会通过JS动态生成 -->
                    </div>
                </div>
            </main>
        </div>

        <!-- 底部导航栏 -->
        <nav class="bottom-nav">
            <div class="bottom-nav-items">
                <div class="nav-item active" data-page="home" onclick="switchPage('home')">
                    <i class="fas fa-home nav-icon"></i>
                    首页
                </div>
                <div class="nav-item" data-page="market" onclick="switchPage('market')">
                    <i class="fas fa-store nav-icon"></i>
                    市场
                </div>
                <div class="nav-item" data-page="publish" onclick="switchPage('publish')">
                    <i class="fas fa-plus-circle nav-icon"></i>
                    发布
                </div>
                <div class="nav-item" data-page="messages" onclick="switchPage('messages')">
                    <i class="fas fa-comments nav-icon"></i>
                    消息
                </div>
                <div class="nav-item" data-page="my" onclick="switchPage('my')">
                    <i class="fas fa-user nav-icon"></i>
                    我的
                </div>
            </div>
        </nav>

        <!-- 返回顶部按钮 -->
        <div class="back-to-top" onclick="scrollToTop()">
            <i class="fas fa-arrow-up"></i>
        </div>

        <!-- 发布成功消息框 -->
        <div class="publish-success-modal" id="publishSuccessModal">
            <div class="publish-success-content">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="success-title">发布成功！</h3>
                <p class="success-message">您的商品已成功发布，正在审核中</p>
                <button class="btn btn-primary" style="width: 100%;" onclick="closePublishSuccessModal()">
                    确定
                </button>
            </div>
        </div>

        <!-- 登录模态框 -->
        <div class="modal" id="loginModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">登录账号</h3>
                    <button class="modal-close" onclick="hideLoginModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                                <i class="fas fa-phone"></i> 手机号
                            </label>
                            <input type="tel" 
                                   class="search-input" 
                                   placeholder="请输入手机号"
                                   required
                                   id="loginPhone"
                                   style="width: 100%;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                                <i class="fas fa-lock"></i> 密码
                            </label>
                            <input type="password" 
                                   class="search-input" 
                                   placeholder="请输入密码"
                                   required
                                   id="loginPassword"
                                   style="width: 100%;">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px;" id="loginSubmitBtn">
                            <i class="fas fa-sign-in-alt"></i> 登录
                        </button>
                    </form>
                    <div style="text-align: center; margin-top: 20px;">
                        <a href="#" style="color: var(--primary); text-decoration: none; font-size: 14px;" onclick="showForgetPassword()">
                            忘记密码？
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 注册模态框 -->
        <div class="modal" id="registerModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">注册账号</h3>
                    <button class="modal-close" onclick="hideRegisterModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="registerForm" onsubmit="handleRegister(event)">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                                <i class="fas fa-phone"></i> 手机号
                            </label>
                            <input type="tel" 
                                   class="search-input" 
                                   placeholder="请输入手机号"
                                   required
                                   id="registerPhone"
                                   style="width: 100%;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                                <i class="fas fa-lock"></i> 密码
                            </label>
                            <input type="password" 
                                   class="search-input" 
                                   placeholder="请输入密码"
                                   required
                                   id="registerPassword"
                                   style="width: 100%;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                                <i class="fas fa-lock"></i> 确认密码
                            </label>
                            <input type="password" 
                                   class="search-input" 
                                   placeholder="请再次输入密码"
                                   required
                                   id="confirmPassword"
                                   style="width: 100%;">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px;" id="registerSubmitBtn">
                            <i class="fas fa-user-plus"></i> 注册
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 应用状态
        const appState = {
            currentPage: 'home',
            currentCategory: 'all',
            currentSort: 'default',
            user: null,
            products: [],
            messages: [],
            isLoading: false,
            marketPage: 1,
            hasMoreMarketProducts: true,
            uploadedImages: [], // 存储上传的图片
            currentChat: null, // 当前聊天对象
            chatMessages: {}, // 存储聊天记录，key为用户名，value为消息数组
            currentProductId: null, // 当前查看的商品ID
            productDetails: {}, // 存储商品详情数据
            cartItems: [], // 购物车商品
            favorites: [], // 收藏的商品
            sellingItems: [], // 我卖出的商品
            buyingItems: [], // 我买到的商品
            previousPage: 'home' // 上一个页面（用于返回功能）
        };

        // 图片扩展名数组，用于尝试不同格式的图片
        const imageExtensions = ['jpg', 'jpeg', 'png', 'webp', 'avif'];

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            loadInitialData();
            setupEventListeners();
            updateBottomNav();
            updateCartBadge();
        });

        function initApp() {
            // 检查用户登录状态
            const savedUser = localStorage.getItem('campusMarketUser');
            if (savedUser) {
                appState.user = JSON.parse(savedUser);
                updateUserUI();
            }
            
            // 加载购物车数据
            loadCartFromLocalStorage();
            
            // 加载收藏数据
            loadFavoritesFromLocalStorage();
            
            // 加载我卖出/买到数据
            loadMyItemsFromLocalStorage();
        }

        function loadInitialData() {
            generateSampleProducts();
            generateSampleMessages();
            generateSampleChatMessages();
            renderHomePage();
            renderMyPage();
        }

        function setupEventListeners() {
            // 滚动时显示返回顶部按钮
            window.addEventListener('scroll', handleScroll);
            
            // 点击模态框外部关闭
            window.addEventListener('click', function(event) {
                const loginModal = document.getElementById('loginModal');
                const registerModal = document.getElementById('registerModal');
                const publishSuccessModal = document.getElementById('publishSuccessModal');
                
                if (event.target === loginModal) {
                    hideLoginModal();
                }
                if (event.target === registerModal) {
                    hideRegisterModal();
                }
                if (event.target === publishSuccessModal) {
                    closePublishSuccessModal();
                }
            });

            // 为上传区域添加拖拽功能
            const uploadArea = document.querySelector('.upload-area');
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--primary)';
                uploadArea.style.background = 'var(--primary-light)';
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--border)';
                uploadArea.style.background = 'transparent';
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--border)';
                uploadArea.style.background = 'transparent';
                
                const files = e.dataTransfer.files;
                handleFiles(files);
            });
        }

        // 处理图片上传
        function handleImageUpload(event) {
            const files = event.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (files.length === 0) return;
            
            // 限制最多上传5张图片
            const remainingSlots = 5 - appState.uploadedImages.length;
            const filesToProcess = Math.min(files.length, remainingSlots);
            
            for (let i = 0; i < filesToProcess; i++) {
                const file = files[i];
                
                // 检查文件类型
                if (!file.type.startsWith('image/')) {
                    showToast('请选择图片文件', 'error');
                    continue;
                }
                
                // 检查文件大小（5MB以内）
                if (file.size > 5 * 1024 * 1024) {
                    showToast('图片大小不能超过5MB', 'error');
                    continue;
                }
                
                // 创建预览
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    const imageId = Date.now() + i;
                    
                    // 添加到状态
                    appState.uploadedImages.push({
                        id: imageId,
                        data: imageData,
                        file: file
                    });
                    
                    // 显示预览
                    renderImagePreview(imageId, imageData);
                };
                reader.readAsDataURL(file);
            }
        }

        function renderImagePreview(id, imageData) {
            const container = document.getElementById('uploadedImages');
            
            const previewDiv = document.createElement('div');
            previewDiv.className = 'image-preview';
            previewDiv.id = 'imagePreview_' + id;
            
            previewDiv.innerHTML = `
                <img src="${imageData}" alt="预览图片">
                <div class="remove-image" onclick="removeImage(${id})">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            container.appendChild(previewDiv);
            
            // 如果这是第一张图片，确保容器可见
            if (appState.uploadedImages.length === 1) {
                container.style.display = 'flex';
            }
        }

        function removeImage(id) {
            // 从状态中移除
            appState.uploadedImages = appState.uploadedImages.filter(img => img.id !== id);
            
            // 从DOM中移除
            const preview = document.getElementById('imagePreview_' + id);
            if (preview) {
                preview.remove();
            }
            
            // 如果没有图片了，隐藏容器
            if (appState.uploadedImages.length === 0) {
                document.getElementById('uploadedImages').style.display = 'none';
            }
        }

        // 根据商品名称获取本地图片路径
        function getLocalImagePath(productTitle) {
            // 基本路径
            const basePath = 'src/';
            
            // 尝试不同扩展名
            for (const ext of imageExtensions) {
                const fileName = productTitle + '.' + ext;
                return basePath + fileName;
            }
            
            // 如果都不存在，返回默认图片
            return 'src/默认图片.jpg';
        }

        // 页面切换函数
        function switchPage(pageName, param = null) {
            if (appState.currentPage === pageName && pageName !== 'productDetail') return;
            
            // 记录上一个页面（用于商品详情页面的返回功能）
            if (pageName !== 'productDetail' && appState.currentPage !== 'productDetail') {
                appState.previousPage = appState.currentPage;
            }
            
            const oldPage = appState.currentPage;
            appState.currentPage = pageName;
            
            // 更新导航状态
            updateNavigation();
            
            // 隐藏所有页面
            document.querySelectorAll('.page-container').forEach(page => {
                page.classList.remove('active');
            });
            
            // 显示目标页面
            const targetPage = document.getElementById(pageName + 'Page');
            if (targetPage) {
                targetPage.classList.add('active');
                
                // 加载页面数据
                switch(pageName) {
                    case 'home':
                        renderHomePage();
                        break;
                    case 'market':
                        loadMarketProducts();
                        break;
                    case 'publish':
                        // 发布页面不需要额外加载
                        break;
                    case 'messages':
                        renderMessagesPage();
                        break;
                    case 'chat':
                        renderChatPage();
                        break;
                    case 'productDetail':
                        loadProductDetail();
                        break;
                    case 'cart':
                        renderCartPage();
                        break;
                    case 'my':
                        renderMyPage();
                        break;
                    case 'mySelling':
                        renderMySellingPage();
                        break;
                    case 'myBuying':
                        renderMyBuyingPage();
                        break;
                    case 'myFavorites':
                        renderMyFavoritesPage();
                        break;
                }
            }
        }

        function updateNavigation() {
            // 更新顶部导航（商品详情页面不显示顶部导航）
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.style.display = appState.currentPage === 'productDetail' ? 'none' : 'flex';
                tab.classList.toggle('active', tab.dataset.page === appState.currentPage);
            });
            
            // 更新底部导航（商品详情页面不显示底部导航）
            const bottomNav = document.querySelector('.bottom-nav');
            if (bottomNav) {
                bottomNav.style.display = appState.currentPage === 'productDetail' ? 'none' : 'block';
            }
            
            // 更新底部导航项
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === appState.currentPage);
            });
        }

        function updateBottomNav() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === appState.currentPage);
            });
        }

        // 首页渲染
        function renderHomePage() {
            renderRecommendedProducts();
            renderHotProducts();
        }

        function renderRecommendedProducts() {
            const container = document.getElementById('recommendedProducts');
            const recommended = appState.products.slice(0, 4);
            
            if (recommended.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-text">暂无推荐商品</div></div>';
                return;
            }
            
            container.innerHTML = recommended.map(product => createProductCard(product)).join('');
        }

        function renderHotProducts() {
            const container = document.getElementById('hotProducts');
            const hotProducts = appState.products.filter(p => p.tags.includes('hot')).slice(0, 4);
            
            if (hotProducts.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-text">暂无热卖商品</div></div>';
                return;
            }
            
            container.innerHTML = hotProducts.map(product => createProductCard(product)).join('');
        }

        // 市场页面
        function loadMarketProducts() {
            appState.marketPage = 1;
            appState.hasMoreMarketProducts = true;
            renderMarketProducts();
        }

        function renderMarketProducts() {
            const container = document.getElementById('marketProducts');
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            
            let filteredProducts = [...appState.products];
            
            // 分类筛选
            if (appState.currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.category === appState.currentCategory);
            }
            
            // 排序
            switch(appState.currentSort) {
                case 'price-low':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'newest':
                    filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
            }
            
            // 分页显示（每页8个）
            const startIndex = (appState.marketPage - 1) * 8;
            const endIndex = startIndex + 8;
            const pageProducts = filteredProducts.slice(startIndex, endIndex);
            
            if (appState.marketPage === 1) {
                container.innerHTML = '';
            }
            
            if (pageProducts.length === 0 && appState.marketPage === 1) {
                container.innerHTML = '<div class="empty-state"><div class="empty-text">暂无商品</div></div>';
                loadMoreContainer.style.display = 'none';
                return;
            }
            
            container.innerHTML += pageProducts.map(product => createProductCard(product)).join('');
            
            // 是否还有更多商品
            appState.hasMoreMarketProducts = endIndex < filteredProducts.length;
            loadMoreContainer.style.display = appState.hasMoreMarketProducts ? 'block' : 'none';
        }

        function filterByCategory(category) {
            appState.currentCategory = category;
            appState.marketPage = 1;
            
            // 更新分类标签
            document.querySelectorAll('.market-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderMarketProducts();
        }

        function filterBySort(sort) {
            appState.currentSort = sort;
            appState.marketPage = 1;
            
            // 更新排序按钮
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderMarketProducts();
        }

        function loadMoreMarketProducts() {
            if (appState.isLoading || !appState.hasMoreMarketProducts) return;
            
            appState.isLoading = true;
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const originalHTML = loadMoreBtn.innerHTML;
            
            loadMoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 加载中...';
            loadMoreBtn.disabled = true;
            
            // 模拟加载延迟
            setTimeout(() => {
                appState.marketPage++;
                renderMarketProducts();
                
                appState.isLoading = false;
                loadMoreBtn.innerHTML = originalHTML;
                loadMoreBtn.disabled = false;
            }, 800);
        }

        // 消息页面
        function renderMessagesPage() {
            const container = document.getElementById('messagesList');
            const noMessages = document.getElementById('noMessages');
            
            if (appState.messages.length === 0) {
                container.style.display = 'none';
                noMessages.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            noMessages.style.display = 'none';
            
            container.innerHTML = appState.messages.map(message => `
                <div class="message-item ${message.unread ? 'unread' : ''}" onclick="openChat('${message.sender}')">
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">${message.sender}</div>
                            <div class="message-time">${formatTime(message.time)}</div>
                        </div>
                        <div class="message-preview">${message.preview}</div>
                    </div>
                    ${message.unread ? '<div class="unread-badge"></div>' : ''}
                </div>
            `).join('');
        }

        function markAllAsRead() {
            appState.messages.forEach(msg => msg.unread = false);
            renderMessagesPage();
            showToast('全部消息已标记为已读');
        }

        // 打开聊天页面
        function openChat(userName) {
            appState.currentChat = userName;
            
            // 将对应的消息标记为已读
            const message = appState.messages.find(m => m.sender === userName);
            if (message) {
                message.unread = false;
            }
            
            switchPage('chat');
        }

        // 聊天页面
        function renderChatPage() {
            const container = document.getElementById('chatContainer');
            
            if (!appState.currentChat) {
                container.innerHTML = `
                    <div class="no-chat-selected">
                        <div>
                            <div class="no-chat-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="empty-text">请选择一个聊天</div>
                            <div class="empty-subtext">从消息列表中选择一个聊天开始对话</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            const chatMessages = appState.chatMessages[appState.currentChat] || [];
            
            container.innerHTML = `
                <div class="chat-header">
                    <button class="back-button" onclick="switchPage('messages')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="chat-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="chat-user-info">
                        <div class="chat-user-name">${appState.currentChat}</div>
                        <div class="chat-user-status">在线</div>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action-btn" onclick="showChatInfo('${appState.currentChat}')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <button class="chat-action-btn" onclick="clearChat('${appState.currentChat}')">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="messages-list" id="messagesListContainer">
                    ${chatMessages.map(msg => `
                        <div class="message-bubble ${msg.sender === appState.currentChat ? 'received' : 'sent'}">
                            <div class="message-text">${msg.text}</div>
                            <div class="message-time">${formatChatTime(msg.time)}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="chat-input-area">
                    <textarea 
                        class="message-input" 
                        placeholder="输入消息..." 
                        id="chatInput"
                        onkeydown="handleChatInputKeydown(event)"
                        rows="1"></textarea>
                    <button class="send-button" onclick="sendChatMessage()" id="sendChatButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            `;
            
            // 滚动到底部
            setTimeout(() => {
                const messagesList = document.getElementById('messagesListContainer');
                if (messagesList) {
                    messagesList.scrollTop = messagesList.scrollHeight;
                }
            }, 100);
        }

        function handleChatInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
            
            // 自动调整文本框高度
            const textarea = event.target;
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const button = document.getElementById('sendChatButton');
            const message = input.value.trim();
            
            if (!message || !appState.currentChat) return;
            
            // 禁用发送按钮
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            // 创建消息对象
            const newMessage = {
                sender: appState.user ? appState.user.name : '我',
                text: message,
                time: new Date()
            };
            
            // 添加到聊天记录
            if (!appState.chatMessages[appState.currentChat]) {
                appState.chatMessages[appState.currentChat] = [];
            }
            appState.chatMessages[appState.currentChat].push(newMessage);
            
            // 清空输入框
            input.value = '';
            input.style.height = 'auto';
            
            // 重新渲染聊天界面
            renderChatPage();
            
            // 模拟对方回复（延迟2-5秒）
            setTimeout(() => {
                const responses = [
                    '好的，我了解了',
                    '这个价格可以商量吗？',
                    '什么时候可以看看实物？',
                    '能便宜点吗？',
                    '好的，我考虑一下',
                    '还有其他图片吗？',
                    '这个还在吗？',
                    '什么时候方便交易？'
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                const replyMessage = {
                    sender: appState.currentChat,
                    text: randomResponse,
                    time: new Date()
                };
                
                appState.chatMessages[appState.currentChat].push(replyMessage);
                renderChatPage();
                
                // 更新消息列表中的预览
                updateMessagePreview(appState.currentChat, randomResponse);
            }, 2000 + Math.random() * 3000);
            
            // 重新启用发送按钮
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-paper-plane"></i>';
            
            // 聚焦到输入框
            input.focus();
        }

        function updateMessagePreview(sender, preview) {
            // 更新消息列表中的预览
            const message = appState.messages.find(m => m.sender === sender);
            if (message) {
                message.preview = preview;
                message.time = new Date();
                message.unread = true;
            }
        }

        function formatChatTime(time) {
            const date = new Date(time);
            return date.getHours().toString().padStart(2, '0') + ':' + 
                   date.getMinutes().toString().padStart(2, '0');
        }

        function showChatInfo(userName) {
            showToast(`查看${userName}的资料`);
        }

        function clearChat(userName) {
            if (confirm(`确定要清空与${userName}的聊天记录吗？`)) {
                appState.chatMessages[userName] = [];
                renderChatPage();
                showToast('聊天记录已清空');
            }
        }

        // 我的页面
        function renderMyPage() {
            if (!appState.user) {
                // 未登录状态
                const container = document.getElementById('myPage');
                container.innerHTML = `
                    <div class="main-content" style="display: flex; align-items: center; justify-content: center; height: 60vh;">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-user-lock"></i>
                            </div>
                            <div class="empty-text">请先登录</div>
                            <div class="empty-subtext">登录后查看个人中心</div>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="showLoginModal()">
                                <i class="fas fa-sign-in-alt"></i> 立即登录
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            renderMyOrders();
        }

        function renderMyOrders() {
            const container = document.getElementById('myOrders');
            const noOrders = document.getElementById('noOrders');
            
            // 固定的订单数据
            const orders = [
                { id: 1, title: '二手MacBook Pro 2020款', price: 5299, time: '2023-10-15', status: 'waiting', productId: 1 },
                { id: 2, title: '高等数学教材 第七版', price: 25, time: '2023-10-12', status: 'success', productId: 2 },
                { id: 3, title: '无线蓝牙耳机', price: 120, time: '2023-10-10', status: 'failed', productId: 3 }
            ];
            
            if (orders.length === 0) {
                container.style.display = 'none';
                noOrders.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            noOrders.style.display = 'none';
            
            container.innerHTML = orders.map(order => `
                <div class="order-item" onclick="viewProductDetail(${order.productId})">
                    <img src="${getLocalImagePath(order.title)}" alt="${order.title}" class="order-image" onerror="this.src='https://picsum.photos/80/80?random=${order.id}'">
                    <div class="order-info">
                        <div class="order-title">${order.title}</div>
                        <div class="order-price">¥${order.price}</div>
                        <div class="product-meta">
                            <span>${order.time}</span>
                        </div>
                    </div>
                    <div class="order-status status-${order.status}">
                        ${getStatusText(order.status)}
                    </div>
                </div>
            `).join('');
        }

        function getStatusText(status) {
            switch(status) {
                case 'waiting': return '待收货';
                case 'success': return '已完成';
                case 'failed': return '已取消';
                default: return '未知状态';
            }
        }

        // 商品详情页面
        function loadProductDetail() {
            const product = appState.products.find(p => p.id === appState.currentProductId);
            if (!product) {
                showToast('商品不存在', 'error');
                switchPage('market');
                return;
            }
            
            // 保存商品详情
            appState.productDetails[product.id] = product;
            
            const container = document.getElementById('productDetailContainer');
            
            // 商家描述示例数据
            const sellerDescriptions = [
                '急出！即将毕业，带不走太多东西',
                '二手，几乎没怎么用过，保养得很好',
                '自用物品，因换新机所以出售',
                '几乎全新，配件齐全，包装都在',
                '毕业大甩卖，价格可小刀',
                '搬家清仓，低价处理',
                '朋友送的礼物，不适合自己用',
                '闲置物品，用得很少，功能完好'
            ];
            
            // 随机选择一个商家描述
            const randomDescription = sellerDescriptions[Math.floor(Math.random() * sellerDescriptions.length)];
            
            // 计算折扣
            const discount = product.originalPrice 
                ? Math.round((1 - product.price / product.originalPrice) * 100)
                : 0;
            
            // 获取本地图片路径
            const localImagePath = getLocalImagePath(product.title);
            
            // 检查是否已收藏
            const isFavorite = appState.favorites.some(fav => fav.id === product.id);
            
            container.innerHTML = `
                <div class="product-detail-header">
                    <button class="product-back-button" onclick="goBackFromProductDetail()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div style="font-weight: 600; flex: 1;">商品详情</div>
                    <button class="product-back-button" onclick="shareProduct(${product.id})">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
                
                <div class="product-detail-content">
                    <!-- 第一部分：商品图片 -->
                    <div class="product-images-section">
                        <img src="${localImagePath}" alt="${product.title}" class="main-product-image" 
                             id="mainProductImage" onerror="this.src='${product.image}'">
                    </div>
                    
                    <!-- 第二部分：商品信息 -->
                    <div class="product-info-section">
                        <div class="product-price-section">
                            <div class="product-current-price">
                                ¥${product.price}
                                ${product.originalPrice ? `
                                    <span class="product-original-price-detail">¥${product.originalPrice}</span>
                                    ${discount > 0 ? `<span class="product-discount-badge">${discount}折</span>` : ''}
                                ` : ''}
                            </div>
                        </div>
                        
                        <h1 class="product-title-detail">${product.title}</h1>
                        
                        <div class="product-tags-detail">
                            ${product.tags.includes('new') ? '<span class="product-tag new">新品</span>' : ''}
                            ${product.tags.includes('hot') ? '<span class="product-tag hot">热卖</span>' : ''}
                            ${product.tags.includes('discount') ? '<span class="product-tag discount">特价</span>' : ''}
                            ${Math.random() > 0.5 ? '<span class="product-tag urgent">急出</span>' : ''}
                        </div>
                        
                        <!-- 商家描述 -->
                        <div class="seller-description">
                            <div class="seller-description-header">
                                <i class="fas fa-bullhorn"></i>
                                <span class="seller-description-title">卖家说明</span>
                            </div>
                            <div class="seller-description-content">
                                ${randomDescription}
                            </div>
                        </div>
                        
                        <!-- 商品规格 -->
                        <div class="product-specs">
                            <div class="spec-item">
                                <span class="spec-label">发布时间</span>
                                <span class="spec-value">${product.time}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">所在位置</span>
                                <span class="spec-value">${product.location}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">商品分类</span>
                                <span class="spec-value">${getCategoryName(product.category)}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">浏览量</span>
                                <span class="spec-value">${product.views}次</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 商品详情描述 -->
                    <div class="product-description-section">
                        <h3 class="section-title-detail">
                            <i class="fas fa-file-alt"></i> 商品描述
                        </h3>
                        <div class="product-full-description">
                            ${product.description || '此商品暂无详细描述'}
                        </div>
                    </div>
                    
                    <!-- 卖家信息 -->
                    <div class="seller-info-section">
                        <div class="seller-avatar">
                            <img src="src/用户头像.jpg" alt="卖家头像" onerror="this.src='https://randomuser.me/api/portraits/men/${product.id % 100}.jpg'">
                        </div>
                        <div class="seller-info">
                            <div class="seller-name">卖家${String.fromCharCode(65 + (product.id % 26))}同学</div>
                            <div class="seller-meta">
                                <span>学号：2023${String(product.id).padStart(4, '0')}</span>
                                <span class="seller-rating">
                                    <i class="fas fa-star"></i> 4.${8 + product.id % 2}
                                </span>
                                <span>${100 + product.id * 10}人关注</span>
                            </div>
                        </div>
                        <button class="btn btn-outline" onclick="contactSeller(${product.id})">
                            <i class="fas fa-comment-dots"></i> 联系卖家
                        </button>
                    </div>
                </div>
                
                <!-- 第三部分：操作按钮 -->
                <div class="product-actions-section">
                    <button class="action-btn action-cart" onclick="addToCart(${product.id})" id="addToCartBtn">
                        <i class="fas fa-shopping-cart"></i> 加入购物车
                    </button>
                    <button class="action-btn action-buy" onclick="buyNow(${product.id})" id="buyNowBtn">
                        <i class="fas fa-bolt"></i> 立即购买
                    </button>
                    <button class="action-btn action-favorite" onclick="toggleFavorite(${product.id})" id="favoriteBtn">
                        <i class="fas fa-heart"></i> ${isFavorite ? '已收藏' : '收藏'}
                    </button>
                </div>
            `;
            
            // 更新浏览量
            updateProductViews(product.id);
        }

        // 获取分类名称
        function getCategoryName(category) {
            const categoryMap = {
                'digital': '数码产品',
                'books': '教材书籍',
                'clothing': '服装鞋帽',
                'daily': '生活用品',
                'sports': '运动户外',
                'beauty': '美妆个护',
                'other': '其他'
            };
            return categoryMap[category] || category;
        }

        // 从商品详情页面返回
        function goBackFromProductDetail() {
            // 返回上一个页面（市场或首页）
            if (appState.currentPage === 'productDetail') {
                switchPage(appState.previousPage || 'market');
            }
        }

        // 更新商品浏览量
        function updateProductViews(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (product) {
                product.views = (product.views || 0) + 1;
            }
        }

        // 收藏功能
        function toggleFavorite(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            const isFavorite = appState.favorites.some(fav => fav.id === productId);
            
            if (isFavorite) {
                // 取消收藏
                appState.favorites = appState.favorites.filter(fav => fav.id !== productId);
                showToast('已取消收藏', 'success');
            } else {
                // 添加收藏
                appState.favorites.push({...product, favoritedAt: new Date()});
                showToast('已添加到收藏', 'success');
            }
            
            // 更新收藏按钮
            const favoriteBtn = document.getElementById('favoriteBtn');
            if (favoriteBtn) {
                favoriteBtn.innerHTML = `<i class="fas fa-heart"></i> ${!isFavorite ? '已收藏' : '收藏'}`;
            }
            
            // 更新收藏数量
            updateFavoriteCount();
            
            // 保存到本地存储
            saveFavoritesToLocalStorage();
        }

        function updateFavoriteCount() {
            const favoriteCount = document.getElementById('favoriteCount');
            if (favoriteCount) {
                favoriteCount.textContent = appState.favorites.length;
            }
            
            if (appState.user) {
                appState.user.favorites = appState.favorites.length;
                updateUserUI();
            }
        }

        function loadFavoritesFromLocalStorage() {
            const savedFavorites = localStorage.getItem('campusMarketFavorites');
            if (savedFavorites) {
                appState.favorites = JSON.parse(savedFavorites);
                updateFavoriteCount();
            }
        }

        function saveFavoritesToLocalStorage() {
            localStorage.setItem('campusMarketFavorites', JSON.stringify(appState.favorites));
        }

        // 购物车功能
        function updateCartBadge() {
            const cartBadge = document.getElementById('cartBadge');
            if (cartBadge) {
                const totalItems = appState.cartItems.reduce((sum, item) => sum + item.quantity, 0);
                cartBadge.textContent = totalItems;
                cartBadge.style.display = totalItems > 0 ? 'flex' : 'none';
            }
        }

        function renderCartPage() {
            const container = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            const cartContainer = document.getElementById('cartContainer');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const cartTotalPrice = document.getElementById('cartTotalPrice');
            
            if (appState.cartItems.length === 0) {
                cartContainer.style.display = 'none';
                emptyCart.style.display = 'block';
                checkoutBtn.disabled = true;
                return;
            }
            
            cartContainer.style.display = 'block';
            emptyCart.style.display = 'none';
            checkoutBtn.disabled = false;
            
            // 计算总价
            let totalPrice = 0;
            
            container.innerHTML = appState.cartItems.map((item, index) => {
                const itemTotal = item.price * item.quantity;
                totalPrice += itemTotal;
                
                return `
                    <div class="cart-item">
                        <img src="${getLocalImagePath(item.title)}" alt="${item.title}" class="cart-item-image" onerror="this.src='${item.image}'">
                        <div class="cart-item-info">
                            <div class="cart-item-title">${item.title}</div>
                            <div class="cart-item-price">¥${item.price}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="updateCartItemQuantity(${index}, ${item.quantity - 1})">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="${item.quantity}" min="1" 
                                       onchange="updateCartItemQuantity(${index}, parseInt(this.value))">
                                <button class="quantity-btn" onclick="updateCartItemQuantity(${index}, ${item.quantity + 1})">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="cart-item-remove" onclick="removeFromCart(${index})">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                `;
            }).join('');
            
            cartTotalPrice.textContent = `¥${totalPrice}`;
        }

        function updateCartItemQuantity(index, newQuantity) {
            if (newQuantity < 1) {
                removeFromCart(index);
                return;
            }
            
            appState.cartItems[index].quantity = newQuantity;
            renderCartPage();
            updateCartBadge();
            saveCartToLocalStorage();
        }

        function removeFromCart(index) {
            appState.cartItems.splice(index, 1);
            renderCartPage();
            updateCartBadge();
            saveCartToLocalStorage();
            showToast('已从购物车移除', 'success');
        }

        function clearCart() {
            if (appState.cartItems.length === 0) return;
            
            if (confirm('确定要清空购物车吗？')) {
                appState.cartItems = [];
                renderCartPage();
                updateCartBadge();
                saveCartToLocalStorage();
                showToast('购物车已清空', 'success');
            }
        }

        function checkoutCart() {
            if (appState.cartItems.length === 0) return;
            
            // 模拟结算过程
            const checkoutBtn = document.getElementById('checkoutBtn');
            const originalHTML = checkoutBtn.innerHTML;
            
            checkoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 结算中...';
            checkoutBtn.disabled = true;
            
            setTimeout(() => {
                // 清空购物车
                appState.cartItems = [];
                renderCartPage();
                updateCartBadge();
                saveCartToLocalStorage();
                
                // 显示成功消息
                showToast('购买成功！订单已创建，请等待卖家联系您', 'success');
                
                // 恢复按钮状态
                checkoutBtn.innerHTML = originalHTML;
                checkoutBtn.disabled = false;
                
                // 切换到我的页面
                setTimeout(() => {
                    switchPage('my');
                }, 1500);
            }, 1500);
        }

        // 我卖出的页面
        function renderMySellingPage() {
            const container = document.getElementById('mySellingProducts');
            
            // 如果没有数据，从市场商品中取一部分作为我卖出的商品
            if (appState.sellingItems.length === 0) {
                appState.sellingItems = appState.products.slice(0, 6);
            }
            
            if (appState.sellingItems.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-text">暂无卖出的商品</div></div>';
                return;
            }
            
            container.innerHTML = appState.sellingItems.map(product => createProductCard(product)).join('');
        }

        // 我买到的页面
        function renderMyBuyingPage() {
            const container = document.getElementById('myBuyingProducts');
            
            // 如果没有数据，从市场商品中取一部分作为我买到的商品
            if (appState.buyingItems.length === 0) {
                appState.buyingItems = appState.products.slice(6, 12);
            }
            
            if (appState.buyingItems.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-text">暂无买到的商品</div></div>';
                return;
            }
            
            container.innerHTML = appState.buyingItems.map(product => createProductCard(product)).join('');
        }

        // 我的收藏页面
        function renderMyFavoritesPage() {
            const container = document.getElementById('myFavoritesProducts');
            
            if (appState.favorites.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-text">暂无收藏的商品</div></div>';
                return;
            }
            
            container.innerHTML = appState.favorites.map(product => createProductCard(product)).join('');
        }

        function clearAllFavorites() {
            if (appState.favorites.length === 0) return;
            
            if (confirm('确定要清空所有收藏吗？')) {
                appState.favorites = [];
                renderMyFavoritesPage();
                updateFavoriteCount();
                saveFavoritesToLocalStorage();
                showToast('收藏已清空', 'success');
            }
        }

        function loadMyItemsFromLocalStorage() {
            const savedSelling = localStorage.getItem('campusMarketSelling');
            const savedBuying = localStorage.getItem('campusMarketBuying');
            
            if (savedSelling) {
                appState.sellingItems = JSON.parse(savedSelling);
            }
            
            if (savedBuying) {
                appState.buyingItems = JSON.parse(savedBuying);
            }
        }

        function saveMyItemsToLocalStorage() {
            localStorage.setItem('campusMarketSelling', JSON.stringify(appState.sellingItems));
            localStorage.setItem('campusMarketBuying', JSON.stringify(appState.buyingItems));
        }

        // 发布商品
        function submitProduct() {
            const title = document.getElementById('productTitle').value.trim();
            const category = document.getElementById('productCategory').value;
            const price = document.getElementById('productPrice').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            const originalPrice = document.getElementById('originalPrice').value.trim();
            const contactPhone = document.getElementById('contactPhone').value.trim();
            
            // 验证表单
            if (!title) {
                showToast('请输入商品标题', 'error');
                document.getElementById('productTitle').focus();
                return;
            }
            
            if (!category) {
                showToast('请选择商品分类', 'error');
                document.getElementById('productCategory').focus();
                return;
            }
            
            if (!price || isNaN(price) || parseFloat(price) <= 0) {
                showToast('请输入有效的商品价格', 'error');
                document.getElementById('productPrice').focus();
                return;
            }
            
            if (!description) {
                showToast('请输入商品描述', 'error');
                document.getElementById('productDescription').focus();
                return;
            }
            
            if (!contactPhone || !/^1[3-9]\d{9}$/.test(contactPhone)) {
                showToast('请输入有效的手机号码', 'error');
                document.getElementById('contactPhone').focus();
                return;
            }
            
            const submitBtn = document.getElementById('submitProductBtn');
            const originalHTML = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 发布中...';
            submitBtn.disabled = true;
            
            // 模拟发布延迟
            setTimeout(() => {
                // 生成随机图片（模拟上传的图片或使用默认图片）
                let imageUrl;
                if (appState.uploadedImages.length > 0) {
                    // 如果有上传的图片，使用第一张
                    imageUrl = appState.uploadedImages[0].data;
                } else {
                    // 否则使用本地图片
                    imageUrl = getLocalImagePath(title);
                }
                
                // 创建新商品
                const newProduct = {
                    id: appState.products.length + 1,
                    title: title,
                    category: category,
                    price: parseFloat(price),
                    originalPrice: originalPrice ? parseFloat(originalPrice) : null,
                    description: description,
                    image: imageUrl,
                    location: '计算机学院',
                    time: '刚刚',
                    views: 0,
                    tags: ['new'],
                    createdAt: new Date()
                };
                
                appState.products.unshift(newProduct);
                
                // 添加到"我卖出的"列表
                appState.sellingItems.unshift(newProduct);
                saveMyItemsToLocalStorage();
                
                // 重置表单
                resetPublishForm();
                
                // 显示成功消息框
                showPublishSuccessModal();
                
                // 恢复按钮状态
                submitBtn.innerHTML = originalHTML;
                submitBtn.disabled = false;
            }, 1500);
        }

        function resetPublishForm() {
            // 清空表单字段
            document.getElementById('productTitle').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('originalPrice').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('contactPhone').value = '13800138000';
            
            // 清空上传的图片
            appState.uploadedImages = [];
            const uploadedImagesContainer = document.getElementById('uploadedImages');
            uploadedImagesContainer.innerHTML = '';
            uploadedImagesContainer.style.display = 'none';
            
            // 重置文件输入
            document.getElementById('imageInput').value = '';
        }

        function showPublishSuccessModal() {
            document.getElementById('publishSuccessModal').style.display = 'flex';
        }

        function closePublishSuccessModal() {
            document.getElementById('publishSuccessModal').style.display = 'none';
            
            // 3秒后自动切换到市场页面
            setTimeout(() => {
                switchPage('market');
            }, 3000);
        }

        // 搜索功能
        function handleSearch(event) {
            if (event.key === 'Enter') {
                const query = document.getElementById('searchInput').value.trim();
                if (query) {
                    switchPage('market');
                    // 这里可以实现具体的搜索逻辑
                    showToast(`搜索: ${query}`);
                }
            }
        }

        // 模态框控制
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function showRegisterModal() {
            document.getElementById('registerModal').style.display = 'flex';
        }

        function hideRegisterModal() {
            document.getElementById('registerModal').style.display = 'none';
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;
            const submitBtn = document.getElementById('loginSubmitBtn');
            const originalHTML = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 登录中...';
            submitBtn.disabled = true;
            
            // 模拟登录延迟
            setTimeout(() => {
                // 模拟用户数据
                appState.user = {
                    id: 1,
                    name: '张三',
                    phone: phone,
                    studentId: '20230001',
                    sellingCount: 12,
                    soldCount: 56,
                    rating: '98.5%',
                    favorites: appState.favorites.length
                };
                
                // 保存到localStorage
                localStorage.setItem('campusMarketUser', JSON.stringify(appState.user));
                
                // 更新UI
                updateUserUI();
                
                // 关闭模态框
                hideLoginModal();
                
                // 显示欢迎消息
                showToast(`欢迎回来，${appState.user.name}！`);
                
                // 恢复按钮状态
                submitBtn.innerHTML = originalHTML;
                submitBtn.disabled = false;
                
                // 刷新我的页面
                renderMyPage();
            }, 1000);
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                showToast('两次输入的密码不一致', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('registerSubmitBtn');
            const originalHTML = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 注册中...';
            submitBtn.disabled = true;
            
            // 模拟注册延迟
            setTimeout(() => {
                // 创建新用户
                appState.user = {
                    id: 2,
                    name: '新用户',
                    phone: phone,
                    studentId: '20230002',
                    sellingCount: 0,
                    soldCount: 0,
                    rating: '0%',
                    favorites: appState.favorites.length
                };
                
                // 保存到localStorage
                localStorage.setItem('campusMarketUser', JSON.stringify(appState.user));
                
                // 更新UI
                updateUserUI();
                
                // 关闭模态框
                hideRegisterModal();
                
                // 显示欢迎消息
                showToast('注册成功！欢迎使用校园二手交易平台');
                
                // 恢复按钮状态
                submitBtn.innerHTML = originalHTML;
                submitBtn.disabled = false;
                
                // 刷新我的页面
                renderMyPage();
            }, 1000);
        }

        function updateUserUI() {
            if (appState.user) {
                document.getElementById('userName').textContent = appState.user.name;
                document.getElementById('sellingCount').textContent = appState.user.sellingCount;
                document.getElementById('soldCount').textContent = appState.user.soldCount;
                document.getElementById('rating').textContent = appState.user.rating;
                document.getElementById('favoriteCount').textContent = appState.user.favorites;
                
                // 更新用户操作按钮
                const userActions = document.querySelector('.user-actions');
                if (userActions) {
                    userActions.innerHTML = `
                        <div class="cart-icon" onclick="switchPage('cart')">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-badge" id="cartBadgeTop">${appState.cartItems.reduce((sum, item) => sum + item.quantity, 0)}</span>
                        </div>
                        <div style="color: var(--text-primary); font-weight: 500;">
                            欢迎，${appState.user.name}
                        </div>
                        <button class="btn btn-outline" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> 退出
                        </button>
                    `;
                    updateCartBadge();
                }
            }
        }

        function logout() {
            if (confirm('确定要退出登录吗？')) {
                appState.user = null;
                localStorage.removeItem('campusMarketUser');
                updateUserUI();
                switchPage('home');
                showToast('已退出登录');
            }
        }

        // 滚动相关
        function handleScroll() {
            const backToTop = document.querySelector('.back-to-top');
            if (window.scrollY > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // 辅助函数
        function createProductCard(product) {
            // 获取本地图片路径
            const localImagePath = getLocalImagePath(product.title);
            
            return `
                <div class="product-card" onclick="viewProductDetail(${product.id})">
                    <div class="product-tags">
                        ${product.tags.includes('new') ? '<span class="tag tag-new">新品</span>' : ''}
                        ${product.tags.includes('hot') ? '<span class="tag tag-hot">热卖</span>' : ''}
                        ${product.tags.includes('discount') ? '<span class="tag tag-discount">特价</span>' : ''}
                    </div>
                    <img src="${localImagePath}" alt="${product.title}" class="product-image" onerror="this.src='${product.image}'">
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-price">
                            ¥${product.price}
                            ${product.originalPrice ? `<span class="product-original-price">¥${product.originalPrice}</span>` : ''}
                        </div>
                        <div class="product-meta">
                            <div class="product-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${product.location}</span>
                            </div>
                            <span>${product.time}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function viewProductDetail(id) {
            appState.currentProductId = id;
            switchPage('productDetail');
        }

        function viewOrderDetail(id) {
            showToast(`查看订单详情 #${id}`);
        }

        // 添加到购物车
        function addToCart(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            // 检查是否已经在购物车中
            const existingItem = appState.cartItems.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
                showToast(`${product.title} 已增加数量`, 'success');
            } else {
                appState.cartItems.push({
                    ...product,
                    quantity: 1
                });
                showToast(`${product.title} 已添加到购物车`, 'success');
            }
            
            // 禁用按钮避免重复点击
            const addToCartBtn = document.getElementById('addToCartBtn');
            const buyNowBtn = document.getElementById('buyNowBtn');
            
            addToCartBtn.disabled = true;
            buyNowBtn.disabled = true;
            addToCartBtn.innerHTML = '<i class="fas fa-check"></i> 已添加';
            
            setTimeout(() => {
                addToCartBtn.disabled = false;
                buyNowBtn.disabled = false;
                addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> 加入购物车';
            }, 2000);
            
            // 保存购物车到本地存储
            saveCartToLocalStorage();
            updateCartBadge();
        }

        // 保存购物车到本地存储
        function saveCartToLocalStorage() {
            localStorage.setItem('campusMarketCart', JSON.stringify(appState.cartItems));
        }

        // 从本地存储加载购物车
        function loadCartFromLocalStorage() {
            const savedCart = localStorage.getItem('campusMarketCart');
            if (savedCart) {
                appState.cartItems = JSON.parse(savedCart);
            }
        }

        // 立即购买
        function buyNow(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            // 添加到购物车
            addToCart(productId);
            
            // 跳转到购物车页面
            setTimeout(() => {
                switchPage('cart');
            }, 500);
        }

        function showToast(message, type = 'success') {
            // 创建Toast元素
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div style="background: ${type === 'error' ? 'var(--error)' : 'var(--success)'}; 
                     color: white; padding: 12px 20px; border-radius: 8px; 
                     position: fixed; top: 80px; right: 20px; z-index: 9999;
                     box-shadow: var(--shadow); display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // 3秒后移除
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function formatTime(time) {
            const now = new Date();
            const msgTime = new Date(time);
            const diff = now - msgTime;
            const diffDays = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return '今天';
            } else if (diffDays === 1) {
                return '昨天';
            } else if (diffDays < 7) {
                return `${diffDays}天前`;
            } else {
                return msgTime.toLocaleDateString();
            }
        }

        // 我的页面菜单功能
        function editProfile() {
            showToast('打开编辑资料页面');
        }

        function viewSettings() {
            showToast('打开设置页面');
        }

        function viewSecurity() {
            showToast('打开安全中心');
        }

        function viewFeedback() {
            showToast('打开意见反馈');
        }

        function viewHelp() {
            showToast('打开帮助中心');
        }

        function viewAbout() {
            showToast('打开关于我们');
        }

        function viewAllOrders() {
            showToast('查看全部订单');
        }

        // 联系卖家
        function contactSeller(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            // 模拟卖家名称（根据商品ID生成）
            const sellerName = `卖家${String.fromCharCode(65 + (productId % 26))}同学`;
            
            // 如果还没有这个卖家的聊天记录，创建一条
            if (!appState.chatMessages[sellerName]) {
                appState.chatMessages[sellerName] = [
                    {
                        sender: sellerName,
                        text: `你好，我对你的商品"${product.title}"很感兴趣`,
                        time: new Date()
                    }
                ];
            }
            
            // 添加到消息列表
            if (!appState.messages.find(m => m.sender === sellerName)) {
                appState.messages.unshift({
                    id: Date.now(),
                    sender: sellerName,
                    preview: `你好，我对你的商品"${product.title}"很感兴趣`,
                    time: new Date(),
                    unread: false
                });
            }
            
            // 切换到聊天页面
            appState.currentChat = sellerName;
            switchPage('chat');
            
            showToast(`开始与${sellerName}聊天`);
        }

        // 分享商品
        function shareProduct(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            // 创建分享模态框
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'shareModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div class="modal-header">
                        <h3 class="modal-title">分享商品</h3>
                        <button class="modal-close" onclick="this.parentElement.parentElement.parentElement.remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 48px; color: var(--primary); margin-bottom: 10px;">
                                <i class="fas fa-share-alt"></i>
                            </div>
                            <h4 style="margin-bottom: 10px;">${product.title}</h4>
                            <div style="color: var(--error); font-size: 20px; font-weight: 700;">
                                ¥${product.price}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 20px;">
                            <div class="quick-item" onclick="shareToWeChat()">
                                <div class="quick-icon">
                                    <i class="fab fa-weixin"></i>
                                </div>
                                <div class="quick-name">微信</div>
                            </div>
                            <div class="quick-item" onclick="shareToQQ()">
                                <div class="quick-icon">
                                    <i class="fab fa-qq"></i>
                                </div>
                                <div class="quick-name">QQ</div>
                            </div>
                            <div class="quick-item" onclick="shareToWeibo()">
                                <div class="quick-icon">
                                    <i class="fab fa-weibo"></i>
                                </div>
                                <div class="quick-name">微博</div>
                            </div>
                            <div class="quick-item" onclick="copyProductLink(${productId})">
                                <div class="quick-icon">
                                    <i class="fas fa-link"></i>
                                </div>
                                <div class="quick-name">复制链接</div>
                            </div>
                        </div>
                        
                        <div style="background: var(--background); padding: 12px; border-radius: 8px; font-size: 12px; color: var(--text-secondary);">
                            <strong>商品链接：</strong>campus-market.com/product/${productId}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        // 生成示例聊天消息
        function generateSampleChatMessages() {
            appState.chatMessages = {
                '张三': [
                    { sender: '张三', text: '你好，这个MacBook Pro还在吗？我想看看实物', time: new Date(Date.now() - 2 * 60 * 60 * 1000) },
                    { sender: '我', text: '还在的，你可以今天下午来看，我在计算机学院教学楼', time: new Date(Date.now() - 1.5 * 60 * 60 * 1000) },
                    { sender: '张三', text: '好的，那我下午3点过来可以吗？', time: new Date(Date.now() - 1 * 60 * 60 * 1000) },
                    { sender: '我', text: '可以的，到时候打我电话13800138000', time: new Date(Date.now() - 0.5 * 60 * 60 * 1000) }
                ],
                '李四': [
                    { sender: '李四', text: '篮球可以便宜一点吗？50元可以吗？', time: new Date(Date.now() - 3 * 60 * 60 * 1000) },
                    { sender: '我', text: '这个已经是骨折价了，最低60元', time: new Date(Date.now() - 2.5 * 60 * 60 * 1000) },
                    { sender: '李四', text: '那好吧，60元我要了，怎么交易？', time: new Date(Date.now() - 2 * 60 * 60 * 1000) }
                ],
                '王五': [
                    { sender: '王五', text: '高等数学教材我要了，今天下午可以交易吗？', time: new Date(Date.now() - 5 * 60 * 60 * 1000) },
                    { sender: '我', text: '可以的，下午2-5点我都在宿舍', time: new Date(Date.now() - 4.5 * 60 * 60 * 1000) },
                    { sender: '王五', text: '好的，我下午3点过来拿', time: new Date(Date.now() - 4 * 60 * 60 * 1000) }
                ]
            };
        }

        // 模拟数据生成 - 已改为固定数据
        function generateSampleProducts() {
            // 固定商品数据 - 使用本地图片
            appState.products = [
                {
                    id: 1,
                    title: '二手MacBook Pro 2020款',
                    category: 'digital',
                    price: 5299,
                    originalPrice: 7999,
                    image: 'src/二手MacBook Pro 2020款.jpg',
                    location: '计算机学院',
                    time: '今天',
                    views: 245,
                    tags: ['new', 'hot'],
                    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000),
                    description: '2020款MacBook Pro，13寸，16GB内存，512GB SSD。外观完好，无划痕，电池健康度90%。因换新机出售，配件齐全。'
                },
                {
                    id: 2,
                    title: '高等数学教材 第七版',
                    category: 'books',
                    price: 25,
                    originalPrice: 45,
                    image: 'src/高等数学教材 第七版.jpg',
                    location: '理学院',
                    time: '昨天',
                    views: 78,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000),
                    description: '高等数学教材第七版，同济大学出版，九成新，内有少量笔记。'
                },
                {
                    id: 3,
                    title: '无线蓝牙耳机',
                    category: 'digital',
                    price: 120,
                    originalPrice: 199,
                    image: 'src/无线蓝牙耳机.jpg',
                    location: '电子信息学院',
                    time: '3小时前',
                    views: 156,
                    tags: ['hot'],
                    createdAt: new Date(Date.now() - 3 * 60 * 60 * 1000),
                    description: '无线蓝牙耳机，音质清晰，续航时间8小时，带充电盒。'
                },
                {
                    id: 4,
                    title: '冬季羽绒服',
                    category: 'clothing',
                    price: 180,
                    originalPrice: 350,
                    image: 'src/冬季羽绒服.jpg',
                    location: '商学院',
                    time: '5分钟前',
                    views: 32,
                    tags: ['new'],
                    createdAt: new Date(Date.now() - 5 * 60 * 1000),
                    description: '冬季羽绒服，黑色，L码，保暖性好，仅穿过几次。'
                },
                {
                    id: 5,
                    title: '篮球',
                    category: 'sports',
                    price: 60,
                    originalPrice: 120,
                    image: 'src/篮球.jpg',
                    location: '体育学院',
                    time: '1小时前',
                    views: 89,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 1 * 60 * 60 * 1000),
                    description: '标准7号篮球，橡胶材质，手感好，适合室内外使用。'
                },
                {
                    id: 6,
                    title: 'Java编程思想',
                    category: 'books',
                    price: 40,
                    originalPrice: 80,
                    image: 'src/Java编程思想.jpg',
                    location: '计算机学院',
                    time: '昨天',
                    views: 102,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 30 * 60 * 60 * 1000),
                    description: 'Java编程思想第五版，经典编程书籍，内有少量笔记。'
                },
                {
                    id: 7,
                    title: '电动滑板车',
                    category: 'sports',
                    price: 450,
                    originalPrice: 800,
                    image: 'src/电动滑板车.jpg',
                    location: '工程学院',
                    time: '今天',
                    views: 201,
                    tags: ['new', 'hot'],
                    createdAt: new Date(Date.now() - 4 * 60 * 60 * 1000),
                    description: '电动滑板车，续航20公里，最高时速25km/h，带LED灯。'
                },
                {
                    id: 8,
                    title: '宿舍台灯',
                    category: 'daily',
                    price: 35,
                    originalPrice: 60,
                    image: 'src/宿舍台灯.jpg',
                    location: '文学院',
                    time: '3小时前',
                    views: 67,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 3 * 60 * 60 * 1000),
                    description: '宿舍LED台灯，三档调光，USB充电，适合学习使用。'
                },
                {
                    id: 9,
                    title: '口红（全新未拆封）',
                    category: 'beauty',
                    price: 80,
                    originalPrice: 150,
                    image: 'src/口红（全新未拆封）.jpg',
                    location: '艺术学院',
                    time: '刚刚',
                    views: 45,
                    tags: ['new'],
                    createdAt: new Date(Date.now() - 10 * 60 * 1000),
                    description: '全新未拆封口红，色号正红色，朋友送的礼物，不适合自己。'
                },
                {
                    id: 10,
                    title: '考研英语词汇书',
                    category: 'books',
                    price: 15,
                    originalPrice: 30,
                    image: 'src/考研英语词汇书.jpg',
                    location: '外国语学院',
                    time: '昨天',
                    views: 123,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 28 * 60 * 60 * 1000),
                    description: '考研英语词汇书，内有少量标记，适合备考使用。'
                },
                {
                    id: 11,
                    title: 'iPad Air 4',
                    category: 'digital',
                    price: 2800,
                    originalPrice: 4299,
                    image: 'src/iPad Air 4.jpg',
                    location: '计算机学院',
                    time: '今天',
                    views: 312,
                    tags: ['hot'],
                    createdAt: new Date(Date.now() - 6 * 60 * 60 * 1000),
                    description: 'iPad Air 4，64GB，WiFi版，外观完好，功能正常。'
                },
                {
                    id: 12,
                    title: '运动鞋 Nike',
                    category: 'sports',
                    price: 220,
                    originalPrice: 450,
                    image: 'src/运动鞋 Nike.jpg',
                    location: '体育学院',
                    time: '2小时前',
                    views: 98,
                    tags: ['new', 'discount'],
                    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000),
                    description: 'Nike运动鞋，42码，黑色，仅穿过几次，清洗干净。'
                },
                {
                    id: 13,
                    title: '耳机收纳盒',
                    category: 'daily',
                    price: 15,
                    originalPrice: 25,
                    image: 'src/耳机收纳盒.jpg',
                    location: '商学院',
                    time: '昨天',
                    views: 56,
                    tags: [],
                    createdAt: new Date(Date.now() - 20 * 60 * 60 * 1000),
                    description: '耳机收纳盒，硅胶材质，可放耳机和充电线。'
                },
                {
                    id: 14,
                    title: 'C++ Primer Plus',
                    category: 'books',
                    price: 35,
                    originalPrice: 70,
                    image: 'src/C++ Primer Plus.jpg',
                    location: '计算机学院',
                    time: '今天',
                    views: 87,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 8 * 60 * 60 * 1000),
                    description: 'C++ Primer Plus第六版，编程入门经典书籍。'
                },
                {
                    id: 15,
                    title: '宿舍椅子',
                    category: 'daily',
                    price: 50,
                    originalPrice: 100,
                    image: 'src/宿舍椅子.jpg',
                    location: '土木学院',
                    time: '3天前',
                    views: 142,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 72 * 60 * 60 * 1000),
                    description: '宿舍椅子，可调节高度，带靠背，舒适耐用。'
                },
                {
                    id: 16,
                    title: '华为智能手表',
                    category: 'digital',
                    price: 400,
                    originalPrice: 699,
                    image: 'src/华为智能手表.jpg',
                    location: '电子信息学院',
                    time: '今天',
                    views: 178,
                    tags: ['new', 'hot'],
                    createdAt: new Date(Date.now() - 5 * 60 * 60 * 1000),
                    description: '华为智能手表，功能齐全，可监测心率、睡眠等。'
                },
                {
                    id: 17,
                    title: '夏季连衣裙',
                    category: 'clothing',
                    price: 65,
                    originalPrice: 130,
                    image: 'src/夏季连衣裙.jpg',
                    location: '艺术学院',
                    time: '昨天',
                    views: 76,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 26 * 60 * 60 * 1000),
                    description: '夏季连衣裙，M码，碎花图案，仅穿过一次。'
                },
                {
                    id: 18,
                    title: '瑜伽垫',
                    category: 'sports',
                    price: 40,
                    originalPrice: 80,
                    image: 'src/瑜伽垫.jpg',
                    location: '体育学院',
                    time: '今天',
                    views: 94,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 9 * 60 * 60 * 1000),
                    description: '瑜伽垫，加厚防滑，适合初学者使用。'
                },
                {
                    id: 19,
                    title: '宿舍小风扇',
                    category: 'daily',
                    price: 25,
                    originalPrice: 45,
                    image: 'src/宿舍小风扇.jpg',
                    location: '理学院',
                    time: '2小时前',
                    views: 63,
                    tags: [],
                    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000),
                    description: '宿舍小风扇，USB接口，三档风力调节。'
                },
                {
                    id: 20,
                    title: '考研政治复习资料',
                    category: 'books',
                    price: 20,
                    originalPrice: 40,
                    image: 'src/考研政治复习资料.jpg',
                    location: '法学院',
                    time: '昨天',
                    views: 115,
                    tags: ['discount'],
                    createdAt: new Date(Date.now() - 22 * 60 * 60 * 1000),
                    description: '考研政治复习资料，包含历年真题和重点解析。'
                }
            ];
        }

        function generateSampleMessages() {
            // 固定消息数据
            appState.messages = [
                {
                    id: 1,
                    sender: '张三',
                    preview: '你好，这个MacBook Pro还在吗？我想看看实物',
                    time: new Date(Date.now() - 1 * 60 * 60 * 1000),
                    unread: true
                },
                {
                    id: 2,
                    sender: '李四',
                    preview: '篮球可以便宜一点吗？50元可以吗？',
                    time: new Date(Date.now() - 2 * 60 * 60 * 1000),
                    unread: true
                },
                {
                    id: 3,
                    sender: '王五',
                    preview: '高等数学教材我要了，今天下午可以交易吗？',
                    time: new Date(Date.now() - 5 * 60 * 60 * 1000),
                    unread: false
                },
                {
                    id: 4,
                    sender: '赵六',
                    preview: '无线蓝牙耳机音质怎么样？可以试听吗？',
                    time: new Date(Date.now() - 12 * 60 * 60 * 1000),
                    unread: false
                },
                {
                    id: 5,
                    sender: '小七',
                    preview: '冬季羽绒服是什么尺码？我身高175能穿吗？',
                    time: new Date(Date.now() - 24 * 60 * 60 * 1000),
                    unread: false
                }
            ];
        }
    </script>
</body>
</html>